import{a as C}from"./chunk-C6VMUQFT.js";import{$d as g,Hd as f,Id as p,Md as o,Nd as u,Zd as i,_d as y,vd as l,wd as d,xd as n}from"./chunk-KBDKS3MK.js";import{a,b as r}from"./chunk-3J24ZBPC.js";var c=d({source:"contact",events:a(a({},i({name:"loadContacts",params:n(),events:{completed:l(),failed:l()}})),i({name:"syncContactChanges",params:n(),events:{completed:l(),failed:l()}}))});function S(e,t){return e.reduce((m,A)=>v(A,m),t)}function v(e,t){try{switch(e.type){case"deletion":return t.delete(e.id);case"creation":return t.insert(e.payload);case"update":return t.update(e.id,e.payload);case"creation-or-update":return t.upsert(e.payload);default:throw new Error(`Unknown sync change
${JSON.stringify(e)}`)}}catch(m){if(m instanceof g)return t;throw m}}var x={currentId:null,contacts:new y(e=>e.id),contactsLoadingStatus:{type:"idle"},syncToken:null},T=u(x,o(C.authenticateCompleted,(e,t)=>r(a({},e),{currentId:t.result.user.id,contacts:e.contacts.upsert(t.result.user)})),o(C.authenticateExpired,e=>r(a({},e),{currentId:null})),o(c.loadContacts,e=>r(a({},e),{contactsLoadingStatus:{type:"pending"}})),o(c.loadContactsCompleted,(e,t)=>r(a({},e),{contacts:e.contacts.upsert(...t.result.results),contactsLoadingStatus:{type:"completed"},syncToken:t.result.syncToken})),o(c.loadContactsFailed,(e,t)=>r(a({},e),{contactsLoadingStatus:{type:"failed",error:t.error}})),o(c.syncContactChangesCompleted,(e,t)=>r(a({},e),{contacts:S(t.result.changes,e.contacts),syncToken:t.result.syncToken})));var J=p({name:"contact",reducer:T,extraSelectors:e=>({selectCurrent:f(e.selectCurrentId,e.selectContacts,(t,m)=>t?m.retrieve(t):null)})});var s=d({source:"mail",events:a(a(a(a(a(a({},i({name:"loadMails",params:n(),events:{completed:l(),failed:l()}})),i({name:"toggleMailStarredStatus",params:l(),events:{completed:l(),failed:l()}})),i({name:"toggleMailReadStatus",params:l(),events:{completed:l(),failed:l()}})),i({name:"moveMailToMailbox",params:l(),events:{completed:l(),failed:l()}})),i({name:"deleteMail",params:l(),events:{completed:n(),failed:l()}})),i({name:"syncMailChanges",params:n(),events:{completed:l(),failed:l()}}))});var I={mails:new y(e=>e.id),mailsLoadingStatus:{type:"idle"},syncToken:null},M=u(I,o(s.loadMails,e=>r(a({},e),{mailsLoadingStatus:{type:"pending"}})),o(s.loadMailsCompleted,(e,t)=>a(r(a({},e),{mails:e.mails.upsert(...t.result.mails),mailsLoadingStatus:{type:"completed"}}),t.result.syncToken?{syncToken:t.result.syncToken}:{})),o(s.loadMailsFailed,(e,t)=>r(a({},e),{mailsLoadingStatus:{type:"failed",error:t.error}})),o(s.toggleMailStarredStatus,(e,t)=>r(a({},e),{mails:e.mails.upsert(r(a({},t.mail),{isStarred:!t.mail.isStarred}))})),o(s.toggleMailStarredStatusCompleted,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.result)})),o(s.toggleMailStarredStatusFailed,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.params.mail)})),o(s.toggleMailReadStatus,(e,t)=>r(a({},e),{mails:e.mails.upsert(r(a({},t.mail),{isRead:!t.mail.isRead}))})),o(s.toggleMailReadStatusCompleted,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.result)})),o(s.toggleMailReadStatusFailed,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.params.mail)})),o(s.moveMailToMailbox,(e,t)=>r(a({},e),{mails:e.mails.upsert(r(a({},t.mail),{mailbox:t.mailbox?.id}))})),o(s.moveMailToMailboxCompleted,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.result)})),o(s.moveMailToMailboxFailed,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.params.mail)})),o(s.deleteMail,(e,t)=>r(a({},e),{mails:e.mails.delete(t.mail.id)})),o(s.deleteMailFailed,(e,t)=>r(a({},e),{mails:e.mails.upsert(t.params.mail)})),o(s.syncMailChangesCompleted,(e,t)=>r(a({},e),{mails:S(t.result.changes,e.mails),syncToken:t.result.syncToken})));var ee=p({name:"mail",reducer:M});export{c as a,J as b,s as c,ee as d};
